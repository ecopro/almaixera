{% extends "base.html" %}


{% block estilscss %}
@media (min-width:650px) {
    .columna1 {
        flex: 4;
    }
    .columna2 {
        flex: 4;
    }
    .contingut {
        display: flex;
    }
}

#temps_restant {
    color: yellow;
}
.pissarra {
    border-radius: 4px;
}
{% endblock %}


{% block contingut %}
<div class="columna1">
Menú usuari:
<ul>
    <li><form action="fer_comanda" method="get">
            {% if data_form %}
                Crea o edita la comanda:<br>
                {{data_form.as_p}}
                <input type="submit" value="Crea o edita"/>
            {% endif %}
        </form>
    </li>
    <li><a href="comandes">Veure comandes</a></li>
    <li><a href="/admin/password_change/">Canvia contrasenya</a></li>
</ul>

<!-- previously if super -->
{% if True %}
Menú admin:
<ul>
    <li><form action="informe_proveidors" method="get">
            {% if prov_form %}
                Informe per proveïdors<br>
                {{prov_form.as_p}}
                <input type="submit" value="Crea informe" />
            {% endif %}
        </form>
    </li>
    <li><form action="informe_caixes" method="get">
            {% if caixes_form %}
                Informe per caixes<br>
                {{caixes_form.as_p}}
                <input type="submit" value="Crea informe" />
            {% endif %}
        </form>
    </li>
    <li><a href="/admin">Panell d'administració</a></li>
</ul>
{% endif %}
</div> <!-- columna1 -->

<div class="columna2">
    <div class="pissarra">
        <div class="pissarratitol">La Pissarra</div>
        <p>proper tancament: {{proper_tancament}}.</p>
        <p>Temps restant: <span id="temps_restant"></span></p>
        <p>... però tranquils, no us estresseu ;)</p>
    </div>
</div>

{% endblock %}



{% block custom_scripts %}

var item = $('#temps_restant')
var temps_restant = parseInt( "{{remaining_secs}}" )

//actualitza()
if( temps_restant>0 ) // proteccio per si alguna cosa falla no vagi recarregant
    setInterval( actualitza, 1000 )

function actualitza() {
    // calculs
    var dies = Math.floor(temps_restant / (3600*24))
    var hores = Math.floor( (temps_restant-dies*(3600*24)) / 3600 )
    var minuts = Math.floor( (temps_restant-dies*(3600*24)-hores*3600) / 60 )
    var segons = Math.floor( (temps_restant-dies*(3600*24)-hores*3600-minuts*60) )
    var mostra = ""
    if( dies ) mostra += dies + " dies "
    if( hores ) mostra += hores +"h "
    if( minuts ) mostra += minuts + "' "
    mostra += segons + "''"
    item.html( mostra )
    --temps_restant
    // colors
    if( dies==0 && hores<2 )
        item.css('color','red')
    // recarreguem si acabem el temps
    if( temps_restant<0 )
        window.location.reload()
}

{% endblock %}
